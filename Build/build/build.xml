<?xml version="1.0"?>

<!-- ======================================================== -->
<!--              Master WONDER Ant build file                -->
<!-- Servers as a facade to other buildfiles.                 -->
<!-- "basedir" is wonder project directory, not "build" where -->
<!-- this files is located.                                   --> 
<!-- ======================================================== -->
<project name="wonder" default="all" basedir="../..">
	
    <!-- ==================================================== -->
    <!--              Import properties.                      -->
    <!-- Properties that are imported first take precedence   -->
    <!-- over the properties imported later.                  -->
    <!-- NOTE: ONLY "default.properties" EXISTS IN CVS,       -->
    <!-- VARIOUS "build.properties" FILEA ARE LOCAL TO        -->
    <!-- THE DEVELOPER MACHINE AND ALLOW BUILD CUSTOMIZATION. -->                       
    <!-- ==================================================== -->
    <property file="${user.home}/build.properties" />
    <property file="Build/build/build.properties" />
    <property file="Build/build/default.properties" />
    
    
    <!-- ==================================================== -->
    <!--              Derived Properties.                     -->
    <!-- These properties are derived from other properties.  -->
    <!-- Normally, these should not be redefined.             -->
    <!-- ==================================================== -->
    <property name="dist" value="${dist.base}/${project.name}-${project.version}"/>
    

    <!-- ==================================================== -->
    <!-- Sets up base properties                              -->
    <!-- ==================================================== -->
    <target name="init" description="initialize properties">
        <property name="wonder.root" value="${basedir}" />
    </target>


    <!-- ==================================================== -->
    <!-- Sets up build and distribution directories.          -->
    <!-- ==================================================== -->
    <target name="prepare">
        <mkdir dir="${dist}"/>
    </target>


    <!-- ==================================================== -->
    <!-- Clean WONDER                                         -->
    <!-- ==================================================== -->
    <target name="clean">
        <delete dir="${dist.base}"/>
    </target>


    <!-- ==================================================== -->
    <!-- Main "build-all" target.                             -->
    <!-- ==================================================== -->
    <target name="all" depends="frameworks, frameworks.install, applications"/>
    
    
    <!-- ==================================================== -->
    <!-- Build Wonder documenatation.                         -->
    <!-- ==================================================== -->
    <target name="doc" depends="init, prepare">
        <ant antfile="Build/build/build-doc.xml"/>
    </target>
    
    <!-- ==================================================== -->
    <!-- Build Wonder Frameworks.                             -->
    <!-- ==================================================== -->
    <target name="frameworks" depends="init">
        <ant antfile="Build/build/generic.xml" target="frameworks.all" />
        <ant antfile="Build/build/generic.xml" target="BTBusinessLogic.all" />
        <ant antfile="Build/build/generic.xml" target="DRGrouping.all" />
        <ant antfile="Build/build/generic.xml" target="ERMiniUglyLook.all" />
        <ant antfile="Build/build/generic.xml" target="SVGObjects.framework.all" />
        <ant antfile="Build/build/generic.xml" target="Validity.framework.all" />
        <ant antfile="Build/build/generic.xml" target="WOPayPal.all" />
        <ant antfile="Build/build/generic.xml" target="WRReporting.all" />
        <ant antfile="Build/build/generic.xml" target="ExcelGenerator.all" />
        <ant antfile="Build/build/generic.xml" target="PostgresqlPlugIn.all" />
    </target>

    <!-- ==================================================== -->
    <!-- Install Wonder Frameworks.                           -->
    <!-- ==================================================== -->
    <target name="frameworks.install">
        <ant antfile="Build/build/generic.xml" target="frameworks.all.install" />
    </target>

    <!-- ==================================================== -->
    <!-- Build Wonder Applications.                           -->
    <!-- ==================================================== -->
    <target name="applications" depends="init, frameworks.install">
        <property name="wonder.development" value="false" />

        <ant antfile="Build/build/generic.xml" target="BugTracker.all" />
        <ant antfile="Build/build/generic.xml" target="D2WInspectExample.all" />
        <ant antfile="Build/build/generic.xml" target="D2WListExample.all" />
        <ant antfile="Build/build/generic.xml" target="DevStudio.all" />
        <ant antfile="Build/build/generic.xml" target="DocsByExample.all" />
        <ant antfile="Build/build/generic.xml" target="DRGroupingTest.all" />
        <ant antfile="Build/build/generic.xml" target="DynaReporter.all" />
        <ant antfile="Build/build/generic.xml" target="ERMailer.all" />
        <ant antfile="Build/build/generic.xml" target="EGSampleApp.all" />
        <ant antfile="Build/build/generic.xml" target="NetStruxrCaseStudy.all" />
        <ant antfile="Build/build/generic.xml" target="SVGObjects.example.all" />
        <ant antfile="Build/build/generic.xml" target="Validity.application.all" />
        <ant antfile="Build/build/generic.xml" target="Validity.example.all" />
    </target>

    <!-- ==================================================== -->
    <!-- Create Wonder Destribution.                          -->
    <!-- ==================================================== -->
    <target name="dist" depends="init, prepare">
        <ant antfile="Build/build/generic.xml" target="all.clean" />
        <antcall target="clean" />

        <property name="wonder.development" value="false" />

        <antcall target="frameworks" />
        <antcall target="frameworks.install" />
        <antcall target="applications" />

        <antcall target="doc" />

        <ant antfile="Build/build/common-dist.xml" target="dist.prebuilt" />
        <ant antfile="Build/build/subprojects-dist.xml" />
        <ant antfile="Build/build/dist-generic.xml" target="all" />
        
    </target>
    
    <!-- ==================================================== -->
    <!-- Deploy Wonder Frameworks.                          -->
    <!-- ==================================================== -->
    <target name="deploy" depends="init, prepare">
        <ant antfile="Build/build/generic.xml" target="all.clean" />
        <antcall target="clean" />

        <property name="wonder.development" value="false" />

        <antcall target="frameworks" />

        <ant antfile="Build/build/common-dist.xml" target="frameworks.all" />
        <ant antfile="Build/build/subprojects-dist.xml" target="WOPayPal.all"/>
        <ant antfile="Build/build/subprojects-dist.xml" target="ExcelGeneration.framework.all"/>
        <ant antfile="Build/build/deploy-artifacts.xml" target="all" />
        
    </target>    
    
    <!-- ==================================================== -->
    <!-- Deploy Wonder Frameworks.                            -->
    <!-- deploy a single project by its name, avoid cleaning  -->
    <!-- and building everything again:                       -->
    <!-- ant -Dsingle.project.name=JavaFileCachingAdaptor -f Build/build/build.xml deploy.single -->
    <!-- ==================================================== -->

    <target name="deploy.single" depends="init, prepare">
        <property name="wonder.development" value="false" />

        <ant antfile="Build/build/common-dist.xml" target="${single.project.name}.all" />
        <ant antfile="Build/build/deploy-artifacts.xml" target="${single.project.name}.all" />
        
    </target>
    
</project>
